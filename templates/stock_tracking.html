{% extends "base.html" %}

{% block title %}Stok Hareketleri - Envanter Sistemi{% endblock %}

{% block content %}
    <p class="text-center text-white-50 lead mb-5">
        KullanÄ±cÄ± panonuzdan iÅŸlemlerinizi hÄ±zlÄ±ca gerÃ§ekleÅŸtirebilirsiniz.
        </p>
    <div class="transtactions_screen">
        
        <div class="screen_header">
            <h2>STOK Ä°ÅLEMLERÄ°</h2>
            <br>
            <p>Envanterdeki Ã¼rÃ¼nlerin giriÅŸ-Ã§Ä±kÄ±ÅŸ iÅŸlemlerini buradan yapabilirsiniz.</p>
        </div>
        <div class="urunler">
           <form action="{{ url_for('open_stock_tracking_page') }}" method="GET" style="display: flex; gap: 10px; align-items: center;">
        
                <label for="kategori"><strong>Kategori Filtrele:</strong></label>
                
                <select name="kategori" id="kat_id" class="form-control" style="width: 200px;" onchange="this.form.submit()">
                    <option value="hepsi">TÃ¼m Kategoriler</option>
                    
                    {% for kategori in kategoriler %}
                        <option value="{{ kategori[0] }}" 
                            {% if aktif_kategori == kategori[0]|string %} selected {% endif %}>
                            {{ kategori[1] }}
                        </option>
                    {% endfor %}
                </select>

            </form>
            <form action="{{url_for('open_stock_tracking_page')}}" method="POST">
            <h3>ğŸ“¦ 1. AdÄ±m: ÃœrÃ¼n SeÃ§imi</h3>
            <div class="product-grid">
                {% for product in products %}
                    <!-- Her Ã¼rÃ¼n bir LABEL iÃ§indedir -->
                    <label class="product-option">
                        <input type="radio" name="product" value="{{ product[0] }}" required>
                            
                        <!-- GÃ–RÃœNEN KART -->
                        <div class="product-card">
                            <!-- Resim Varsa -->
                            {% if product[-1] %}
                                <img src="{{ url_for('static', filename='product_images/' + product[-1]) }}" class="product-img" width="150" height="150">
                            {% else %}
                                <img src="{{ url_for('static', filename='images/no-image.png') }}" class="product-img" width="150" height="150">
                            {% endif %}

                            <div class="product-name">{{ product[2]}} - {{ product[1] }}</div>
                            <div class="stock-info">Stok: {{ product[3] }}</div>
                        </div>
                    </label>
                {% endfor %}
            </div>
        </div>
        
        <div class="islemBilgileri">
            <h3>âš™ï¸ 2. AdÄ±m: Ä°ÅŸlem DetaylarÄ±</h3>
            <!-- FLAÅ MESAJLARI GÃ–STERME ALANI BAÅLANGICI -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="flash-messages">
                        {% for category, message in messages %}
                            <!-- 'category' python'dan gelen 'success' veya 'danger' kelimesidir -->
                            <div class="alert alert-{{ category }}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}
            <!-- FLAÅ MESAJLARI GÃ–STERME ALANI BÄ°TÄ°ÅÄ° -->
            <table>
                <tr><td>Ä°ÅŸlem TÃ¼rÃ¼:</td><td>
                    <div class="radio-group">
                        <!-- GÄ°RÄ°Å SEÃ‡ENEÄÄ° -->
                        <label style="margin-right: 15px; cursor: pointer;">
                            <input type="radio" name="transaction_type" value="GiriÅŸ" class="veriGiris" required checked>
                            <span style="color: green; font-weight: bold;">ğŸ“¥ GiriÅŸ (Stok Ekle)</span>
                        </label>

                        <!-- Ã‡IKIÅ SEÃ‡ENEÄÄ° -->
                        <label style="cursor: pointer;">
                            <input type="radio" name="transaction_type" value="Ã‡Ä±kÄ±ÅŸ" class="veriGiris" required>
                            <span style="color: red; font-weight: bold;">ğŸ“¤ Ã‡Ä±kÄ±ÅŸ (Stok DÃ¼ÅŸ)</span>
                        </label>
                    </div>
                </td></tr>
                <tr><td>Miktar:</td><td>
                    <input type="number" name="miktar" class="veriGiris" min="0.01" step="0.01" required placeholder="0.00">
                </td></tr>
                <tr><td>Ä°ÅŸlem Tarihi:</td><td>
                    <input type="datetime-local" name="date" class="veriGiris", required>
                </td></tr>
                <tr><td>AÃ§Ä±klama:</td><td>
                    <textarea name="note" rows="3" placeholder="Ã–rn: Proje-1 iÃ§in kullanÄ±ldÄ±, ÃœrÃ¼n stoÄŸu gÃ¼ncellendi..."></textarea>
                </td></tr>
                <tr><td colspan="2"><input class="onay_butonu" type="submit" value="ONAYLA"></td></tr>
                <tr><td colspan="2"><input class="reset_butonu" type="reset" value="VAZGEÃ‡"></td></tr>
            </table>
        </form>
        <div class="anasayfaya_don">
        <ul>
            <li>
                <a href="{% if session['rol'] == 'admin' %}{{ url_for('dashboard_admin') }}{% else %}{{ url_for('dashboard_user') }}{% endif %}">
                    Anasayfaya DÃ¶n
                </a>
            </li>
        </ul>
        </div>
        </div>
    </div>

{% endblock %}